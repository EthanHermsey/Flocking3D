varying vec2 vUv;
uniform sampler2D source[2];
uniform float radius;

vec3 wrapBoundaries(in vec3 pos){
    for (int i = 0; i < 3; i++){
        if (pos[i] < -radius) pos[i] = radius;
        if (pos[i] > radius) pos[i] = -radius;
    }
    return pos;
}

void main() {
    vec3 pos = texture2D( source[0], vUv ).rgb;
    vec3 vel = texture2D( source[1], vUv ).rgb;
    vec3 newPos = (pos + vel);
    newPos = wrapBoundaries( newPos );

    gl_FragColor = vec4(newPos, 1.0);
}